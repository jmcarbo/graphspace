<html>
<head>
<script type="text/javascript" src="/static/jquery-1.11.2.js"></script>
<title>graphspace - graphviz editor</title>
</head>
<body>

<input type=radio name=format value=dot checked=true> dot &nbsp; 
<input type=radio name=format value=neato> neato &nbsp; 
<br>
<textarea id=text name=text rows=15 cols=30>
</textarea>
<br>

<input class=update type=submit name=btn value=Submit>
<br>

<div id=link></div>
<div id=graph>click submit to update image</div>

<script>
function getUrlParameter(sParam)
{
    var sPageURL = window.location.search.substring(1);
    var sURLVariables = sPageURL.split('&');
    for (var i = 0; i < sURLVariables.length; i++) 
    {
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam) 
        {
            return sParameterName[1];
        }
    }
}         

$(function() {
 $('.update').click(function(){

   $.ajax({
      type: "POST",
      url: "/proc",
      contentType: "image/png",
      dataType: "json",
      data: $('#text').val(),
      success: function(data) {
         $('#link').html('<a href="?id=' + data.id + '">share<a/>')
         $('#graph').html('<img src="data:image/png;base64,' + data.image + '"/>')
      }
   })
   return false;
 });

 id = getUrlParameter("id")
 if (id) {
   $.ajax({
      type: "POST",
      url: "/proc?id=" + id,
      contentType: "image/png",
      dataType: "json",
      success: function(data) {
         $('#text').val(data.text)
         $('#link').html('<a href="?id=' + data.id + '">share<a/>')
         $('#graph').html('<img src="data:image/png;base64,' + data.image + '"/>')
      }
   })
    
 }


});
</script>
</body>
