<html>
<head>
<link rel="stylesheet" href="/static/jquery-ui.css">
<style>
body {
      font-family: "Trebuchet MS", "Helvetica", "Arial",  "Verdana", "sans-serif";
      font-size: 82.5%;
}
</style>

<script type="text/javascript" src="/static/jquery-1.11.2.js"></script>
<script type="text/javascript" src="/static/jquery-ui.js"></script>
<title>graphspace - graphviz editor</title>
</head>
<body>
<div style="width: 80%;">
   <a href="/"><b>Graphspace</b></a> is a tool for building graphviz graphs &nbsp; 
     &nbsp; <a href="?id=example">example</a> &nbsp;
   - &nbsp; <a href="?id=random">random</a> &nbsp;
   - &nbsp; <a href="http://www.graphviz.org/Gallery.php">gallery</a> &nbsp;
   - &nbsp; <a href="http://github.com/sigmonsays/graphspace">code</a> &nbsp;
</div>
<p>

<form id=form>
<div id="tabs">
   <ul>
      <li><a href="#tabs-1">Editor</a></li>
      <li><a href="#tabs-2">Settings</a></li>
   </ul>
   <div id="tabs-1">
         <input type=radio name=format value=dot checked=true> dot &nbsp; 
         <input type=radio name=format value=neato> neato &nbsp; 
         <input type=radio name=format value=twopi> twopi &nbsp; 
         <input type=radio name=format value=circle> circle &nbsp; 
         <input type=radio name=format value=fdp> fdp &nbsp; 
         <input type=radio name=format value=sfdp> sfdp &nbsp; 
         <input type=radio name=format value=patchwork> patchwork &nbsp; 
         <p>
         Description <input style="width: 50%" type=text id=description name=description>
         <p>
         <textarea style="width: 80%;" id=text name=text rows=15 cols=50></textarea>
         <br>

      <br>
   </div>
   <div id="tabs-2">
      Optimal Width and Height (assumed 100 DPI)<br>
      Width <input type=text name=width size=4> &nbsp; Height <input type=text name=height size=4>  (ie 5 x 5)
      <p>
      Output Format
         <input type=radio name=output value=png checked=true> PNG &nbsp; 
         <input type=radio name=output value=jpg> JPG &nbsp; 
         <input type=radio name=output value=svg> SVG &nbsp; 

   </div>
</div>
<br>
<input class=update type=button name=btn value="Update Graph">
</form>

<div id=link></div>
<div id=graph>click submit to update image</div>

<script>
$.fn.serializeObject = function()
{
    var o = {};
    var a = this.serializeArray();
    $.each(a, function() {
        if (o[this.name] !== undefined) {
            if (!o[this.name].push) {
                o[this.name] = [o[this.name]];
            }
            o[this.name].push(this.value || '');
        } else {
            o[this.name] = this.value || '';
        }
    });
    return o;
};


function getUrlParameter(sParam)
{
    var sPageURL = window.location.search.substring(1);
    var sURLVariables = sPageURL.split('&');
    for (var i = 0; i < sURLVariables.length; i++) 
    {
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam) 
        {
            return sParameterName[1];
        }
    }
}         

function updateImage(data) {
   var img_url = '/image/graph.' + data.output + '?id=' + data.id
   var link_text = '<a href="?id=' + data.id + '">share<a/>'
   link_text += '&nbsp; <a href="' + img_url + '">image<a/>'
   $('#link').html(link_text)

   $('#graph').html('<a href="' + img_url + '"><img src="data:' + data.content_type + ';base64,' + data.image + '"/></a>')
   $('#text').val(data.text)
   $('#description').val(data.description)


   if (data.format) {
      $("#form input[name='format'][value=" + data.format + "]").attr('checked', 'checked')
   }
   if (data.output) {
      $("#form input[name='output'][value=" + data.output + "]").attr('checked', 'checked')
   }
}

$(function() {
 $('#tabs').tabs({
    collapsible: true
 })

 $('.update').click(function(){

   $.ajax({
      type: "POST",
      url: "/proc",
      contentType: "image/png",
      dataType: "json",
      data: JSON.stringify($('#form').serializeObject()),
      success: function(data) {
         updateImage(data)
      }
   })
   return false;
 });

 id = getUrlParameter("id")
 if (id) {
   $.ajax({
      type: "POST",
      url: "/proc?format=" + $("#form input[name='format']:checked").val() + "&id=" + id,
      contentType: "image/png",
      dataType: "json",
      success: function(data) {
         updateImage(data)
      }
   })
    
 }


});
</script>
</body>
