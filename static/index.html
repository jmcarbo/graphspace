<html>
<head>
<link rel="stylesheet" href="/static/jquery-ui.css">
<style>
body {
      font-family: "Trebuchet MS", "Helvetica", "Arial",  "Verdana", "sans-serif";
      font-size: 82.5%;
}
</style>

<script type="text/javascript" src="/static/jquery-1.11.2.js"></script>
<script type="text/javascript" src="/static/jquery-ui.js"></script>
<title>graphspace - graphviz editor</title>
</head>
<body>
<div style="width: 80%;">
<b>Graphspace</b> is a tool for building graphviz graphs &nbsp; 
   - &nbsp; <a href="?id=example">example</a> &nbsp;
   - &nbsp; <a href="?id=random">random</a> &nbsp;
   - &nbsp; <a href="http://www.graphviz.org/Gallery.php">gallery</a> &nbsp;
   - &nbsp; <a href="http://github.com/sigmonsays/graphspace">code</a> &nbsp;
   - &nbsp;  
</div>
<p>

<form id=form>
<div id="tabs">
   <ul>
      <li><a href="#tabs-1">Editor</a></li>
      <li><a href="#tabs-2">Settings</a></li>
   </ul>
   <div id="tabs-1">
         <input type=radio name=format value=dot checked=true> dot &nbsp; 
         <input type=radio name=format value=neato> neato &nbsp; 
         <input type=radio name=format value=twopi> twopi &nbsp; 
         <input type=radio name=format value=circle> circle &nbsp; 
         <input type=radio name=format value=fdp> fdp &nbsp; 
         <input type=radio name=format value=sfdp> sfdp &nbsp; 
         <input type=radio name=format value=patchwork> patchwork &nbsp; 
         <br>
         <textarea style="width: 80%;" id=text name=text rows=15 cols=50></textarea>
         <br>

      <br>
   </div>
   <div id="tabs-2">
      Optimal Width and Height (assumed 100 DPI)<br>
      Width <input type=text name=width value=5 size=4> &nbsp; Height <input type=text name=height value=5 size=4> 
      <p>

   </div>
</div>
<br>
<input class=update type=button name=btn value="Update Graph">
<hr>
</form>

<div id=link></div>
<div id=graph>click submit to update image</div>

<script>
$.fn.serializeObject = function()
{
    var o = {};
    var a = this.serializeArray();
    $.each(a, function() {
        if (o[this.name] !== undefined) {
            if (!o[this.name].push) {
                o[this.name] = [o[this.name]];
            }
            o[this.name].push(this.value || '');
        } else {
            o[this.name] = this.value || '';
        }
    });
    return o;
};


function getUrlParameter(sParam)
{
    var sPageURL = window.location.search.substring(1);
    var sURLVariables = sPageURL.split('&');
    for (var i = 0; i < sURLVariables.length; i++) 
    {
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam) 
        {
            return sParameterName[1];
        }
    }
}         

$(function() {
 $('#tabs').tabs()

 $('.update').click(function(){

   $.ajax({
      type: "POST",
      url: "/proc",
      contentType: "image/png",
      dataType: "json",
      data: JSON.stringify($('#form').serializeObject()),
      success: function(data) {
         $('#link').html('<a href="?id=' + data.id + '">share<a/>')
         $('#graph').html('<img src="data:image/png;base64,' + data.image + '"/>')
      }
   })
   return false;
 });

 id = getUrlParameter("id")
 if (id) {
   $.ajax({
      type: "POST",
      url: "/proc?format=" + $("#form input[name='format']:checked").val() + "&id=" + id,
      contentType: "image/png",
      dataType: "json",
      success: function(data) {
         $("#form input[name='format'][value=" + data.format + "]").attr('checked', 'checked')
         $('#text').val(data.text)
         $('#link').html('<a href="?id=' + data.id + '">share<a/>')
         $('#graph').html('<img src="data:image/png;base64,' + data.image + '"/>')
      }
   })
    
 }


});
</script>
</body>
