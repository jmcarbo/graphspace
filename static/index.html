<html>
<head>
<script type="text/javascript" src="/static/jquery-1.11.2.js"></script>
<title>graphspace - graphviz editor</title>
</head>
<body>
<form id=form>
   <input type=radio name=format value=dot checked=true> dot &nbsp; 
   <input type=radio name=format value=neato> neato &nbsp; 
   <input type=radio name=format value=twopi> twopi &nbsp; 
   <input type=radio name=format value=circle> circle &nbsp; 
   <input type=radio name=format value=fdp> fdp &nbsp; 
   <input type=radio name=format value=sfdp> sfdp &nbsp; 
   <input type=radio name=format value=patchwork> patchwork &nbsp; 
   <br>
   <textarea id=text name=text rows=15 cols=30>
   </textarea>
   <br>

<input class=update type=button name=btn value=Submit>
<br>
</form>

<div id=link></div>
<div id=graph>click submit to update image</div>

<script>
function getUrlParameter(sParam)
{
    var sPageURL = window.location.search.substring(1);
    var sURLVariables = sPageURL.split('&');
    for (var i = 0; i < sURLVariables.length; i++) 
    {
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam) 
        {
            return sParameterName[1];
        }
    }
}         

$(function() {
 $('.update').click(function(){

   $.ajax({
      type: "POST",
      url: "/proc?format=" + $('#form input[name=format]:checked').val(),
      contentType: "image/png",
      dataType: "json",
      data: $('#text').val(),
      success: function(data) {
         $('#link').html('<a href="?id=' + data.id + '">share<a/>')
         $('#graph').html('<img src="data:image/png;base64,' + data.image + '"/>')
      }
   })
   return false;
 });

 id = getUrlParameter("id")
 if (id) {
   $.ajax({
      type: "POST",
      url: "/proc?format=" + $('#form input[name=format]:checked').val() + "&id=" + id,
      contentType: "image/png",
      dataType: "json",
      success: function(data) {
         $('#form input[name=format][value=' + data.format + ']').attr('checked', 'checked')
         $('#text').val(data.text)
         $('#link').html('<a href="?id=' + data.id + '">share<a/>')
         $('#graph').html('<img src="data:image/png;base64,' + data.image + '"/>')
      }
   })
    
 }


});
</script>
</body>
